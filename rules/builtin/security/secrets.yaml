---
# Security Rules - Hardcoded Secrets Detection
# 20+ rules for detecting hardcoded credentials, API keys, tokens, and secrets

- id: SEC001
  name: Hardcoded API Key Detection
  description: Detects hardcoded API keys in source code
  severity: critical
  category: security
  tags: [secrets, credentials, api-keys]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: (?i)(api[_-]?key|apikey)\s*[:=]\s*['"][a-zA-Z0-9+/=]{16,}['"]
  conditions:
    fileExclude:
      - "**/*.test.*"
      - "**/*.spec.*"
      - "**/test/**"
      - "**/tests/**"
  references:
    - https://owasp.org/Top10/A02_2021-Cryptographic_Failures/
  cwe: [CWE-798]
  message: Hardcoded API key detected. Use environment variables instead.
  fix:
    type: replace
    template: process.env.API_KEY
    confidence: 0.7

- id: SEC002
  name: Hardcoded Password Detection
  description: Detects hardcoded passwords in source code
  severity: critical
  category: security
  tags: [secrets, credentials, passwords]
  languages: [javascript, typescript, python, go, java, ruby, php, csharp]
  patterns:
    regex: (?i)(password|passwd|pwd)\s*[:=]\s*['"][^'"]{8,}['"]
  conditions:
    fileExclude:
      - "**/*.test.*"
      - "**/*.spec.*"
  references:
    - https://cwe.mitre.org/data/definitions/798.html
  cwe: [CWE-798]
  message: Hardcoded password detected. Use secure credential storage.

- id: SEC003
  name: Hardcoded Secret Token
  description: Detects hardcoded secret tokens and access tokens
  severity: critical
  category: security
  tags: [secrets, tokens]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: (?i)(secret|token|access[_-]?token)\s*[:=]\s*['"][a-zA-Z0-9+/=_-]{20,}['"]
  cwe: [CWE-798]
  message: Hardcoded secret token detected.

- id: SEC004
  name: AWS Access Key
  description: Detects hardcoded AWS access keys
  severity: critical
  category: security
  tags: [secrets, aws, cloud]
  languages: [javascript, typescript, python, go, java, ruby, php, yaml, json]
  patterns:
    regex: (AKIA|A3T|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[0-9A-Z]{16}
  cwe: [CWE-798]
  message: AWS access key detected. Rotate immediately and use IAM roles.

- id: SEC005
  name: AWS Secret Key
  description: Detects hardcoded AWS secret keys
  severity: critical
  category: security
  tags: [secrets, aws, cloud]
  languages: [javascript, typescript, python, go, java, ruby, php, yaml, json]
  patterns:
    regex: (?i)aws[_-]?secret[_-]?access[_-]?key['"]?\s*[:=]\s*['"][a-zA-Z0-9/+=]{40}['"]
  cwe: [CWE-798]
  message: AWS secret key detected. Rotate immediately.

- id: SEC006
  name: GitHub Token
  description: Detects hardcoded GitHub personal access tokens
  severity: critical
  category: security
  tags: [secrets, github, tokens]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: ghp_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59}
  cwe: [CWE-798]
  message: GitHub token detected. Revoke and use GitHub Secrets.

- id: SEC007
  name: Google API Key
  description: Detects hardcoded Google API keys
  severity: critical
  category: security
  tags: [secrets, google, api-keys]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: AIza[0-9A-Za-z\\-_]{35}
  cwe: [CWE-798]
  message: Google API key detected.

- id: SEC008
  name: Slack Token
  description: Detects hardcoded Slack tokens
  severity: critical
  category: security
  tags: [secrets, slack, tokens]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: xox[pborsa]-[0-9]{12}-[0-9]{12}-[0-9]{12}-[a-z0-9]{32}
  cwe: [CWE-798]
  message: Slack token detected.

- id: SEC009
  name: Stripe API Key
  description: Detects hardcoded Stripe API keys
  severity: critical
  category: security
  tags: [secrets, stripe, api-keys, payment]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: (sk|pk)_(test|live)_[0-9a-zA-Z]{24,}
  cwe: [CWE-798]
  message: Stripe API key detected.

- id: SEC010
  name: RSA Private Key
  description: Detects exposed RSA private keys
  severity: critical
  category: security
  tags: [secrets, encryption, private-key]
  languages: [javascript, typescript, python, go, java, ruby, php, pem]
  patterns:
    regex: -----BEGIN (RSA |OPENSSH |DSA |EC |PGP )?PRIVATE KEY-----
  cwe: [CWE-312]
  message: RSA private key detected in code.

- id: SEC011
  name: SSH Private Key
  description: Detects SSH private keys in code
  severity: critical
  category: security
  tags: [secrets, ssh, private-key]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: -----BEGIN OPENSSH PRIVATE KEY-----
  cwe: [CWE-312]
  message: SSH private key detected.

- id: SEC012
  name: JWT Token
  description: Detects hardcoded JWT tokens
  severity: high
  category: security
  tags: [secrets, jwt, tokens]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: eyJ[a-zA-Z0-9_-]*\.eyJ[a-zA-Z0-9_-]*\.[a-zA-Z0-9_-]*
  cwe: [CWE-798]
  message: JWT token detected in code.

- id: SEC013
  name: Twilio API Key
  description: Detects hardcoded Twilio API keys
  severity: critical
  category: security
  tags: [secrets, twilio, api-keys]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: SK[a-z0-9]{32}
  cwe: [CWE-798]
  message: Twilio API key detected.

- id: SEC014
  name: SendGrid API Key
  description: Detects hardcoded SendGrid API keys
  severity: critical
  category: security
  tags: [secrets, sendgrid, api-keys, email]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: SG\.[a-zA-Z0-9_-]{22}\.[a-zA-Z0-9_-]{43}
  cwe: [CWE-798]
  message: SendGrid API key detected.

- id: SEC015
  name: Mailgun API Key
  description: Detects hardcoded Mailgun API keys
  severity: critical
  category: security
  tags: [secrets, mailgun, api-keys, email]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: key-[0-9a-zA-Z]{32}
  cwe: [CWE-798]
  message: Mailgun API key detected.

- id: SEC016
  name: Database Connection String
  description: Detects hardcoded database connection strings with credentials
  severity: critical
  category: security
  tags: [secrets, database, connection-string]
  languages: [javascript, typescript, python, go, java, ruby, php, csharp]
  patterns:
    regex: (mongodb|mysql|postgres|postgresql|mssql):\/\/[^:]+:[^@]+@
  cwe: [CWE-798]
  message: Database connection string with credentials detected.

- id: SEC017
  name: Firebase API Key
  description: Detects hardcoded Firebase API keys
  severity: high
  category: security
  tags: [secrets, firebase, api-keys]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: (?i)firebase[_-]?api[_-]?key['"]?\s*[:=]\s*['"][a-zA-Z0-9_-]{39}['"]
  cwe: [CWE-798]
  message: Firebase API key detected.

- id: SEC018
  name: Heroku API Key
  description: Detects hardcoded Heroku API keys
  severity: critical
  category: security
  tags: [secrets, heroku, api-keys]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: (?i)heroku[_-]?api[_-]?key['"]?\s*[:=]\s*['"][a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}['"]
  cwe: [CWE-798]
  message: Heroku API key detected.

- id: SEC019
  name: Square Access Token
  description: Detects hardcoded Square access tokens
  severity: critical
  category: security
  tags: [secrets, square, tokens, payment]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: sq0atp-[0-9A-Za-z\\-_]{22}
  cwe: [CWE-798]
  message: Square access token detected.

- id: SEC020
  name: PayPal Token
  description: Detects hardcoded PayPal tokens
  severity: critical
  category: security
  tags: [secrets, paypal, tokens, payment]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: access_token\$production\$[0-9a-z]{16}\$[0-9a-f]{32}
  cwe: [CWE-798]
  message: PayPal token detected.

- id: SEC021
  name: Generic Secret Pattern
  description: Detects generic secret patterns in configuration
  severity: high
  category: security
  tags: [secrets, generic]
  languages: [javascript, typescript, python, go, java, ruby, php, yaml, json]
  patterns:
    regex: (?i)(secret|private[_-]?key|credentials?)['":].*[a-zA-Z0-9+/=_-]{32,}
  conditions:
    fileMatch:
      - "**/*.config.*"
      - "**/*.env.*"
      - "**/config/**"
  cwe: [CWE-798]
  message: Potential secret detected in configuration.

- id: SEC022
  name: NPM Token
  description: Detects hardcoded npm tokens
  severity: critical
  category: security
  tags: [secrets, npm, tokens]
  languages: [javascript, typescript, json, yaml]
  patterns:
    regex: npm_[a-zA-Z0-9]{36}
  cwe: [CWE-798]
  message: NPM token detected.

- id: SEC023
  name: Docker Hub Token
  description: Detects hardcoded Docker Hub tokens
  severity: critical
  category: security
  tags: [secrets, docker, tokens]
  languages: [javascript, typescript, python, go, java, yaml, json]
  patterns:
    regex: (?i)docker[_-]?hub[_-]?token['"]?\s*[:=]\s*['"][a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}['"]
  cwe: [CWE-798]
  message: Docker Hub token detected.

- id: SEC024
  name: Gitlab Token
  description: Detects hardcoded GitLab tokens
  severity: critical
  category: security
  tags: [secrets, gitlab, tokens]
  languages: [javascript, typescript, python, go, java, ruby, php]
  patterns:
    regex: glpat-[0-9a-zA-Z\\-_]{20}
  cwe: [CWE-798]
  message: GitLab token detected.
